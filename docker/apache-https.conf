# Apache configuration for OJS behind HTTPS reverse proxy
# This ensures Apache and PHP properly detect HTTPS from forwarded headers

# Set HTTPS environment when forwarded from reverse proxy
SetEnvIf X-Forwarded-Proto "^https$" HTTPS=on
SetEnvIf X-Forwarded-Port "^443$" SERVER_PORT=443
SetEnvIf X-Forwarded-SSL "^on$" HTTPS=on

# Additional rewrite rules for HTTPS detection
RewriteEngine On

# If we detect forwarded HTTPS, set environment
RewriteCond %{HTTP:X-Forwarded-Proto} ^https$ [NC]
RewriteRule .* - [E=HTTPS:on,E=SERVER_PORT:443]

# For publications.fstu.uz, always assume HTTPS
RewriteCond %{HTTP_HOST} ^publications\.fstu\.uz$ [NC]
RewriteRule .* - [E=HTTPS:on,E=SERVER_PORT:443] 